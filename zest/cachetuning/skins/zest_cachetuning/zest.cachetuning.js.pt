<tal:block tal:define="tool nocall: context/portal_zestcachetuning"
           tal:condition="tool">
(function($) {
    function replace_fullname() {
	var username_holder = $('<span tal:replace="tool/jq_replace_username_selector" />');

	// We save the previous value.
	var old_value = username_holder.html();
	username_holder.load('@@zestcachetuning_get_username',
			     function() {
				 if (username_holder.html() == '') {
				     username_holder.html(old_value);
				 }
			     });
    }

    $(document).ready(function() {
    <tal:block tal:condition="tool/jq_replace_username">
	replace_fullname();
    </tal:block>
    });
})(jQuery)
</tal:block>